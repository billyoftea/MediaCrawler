# 小红书时间筛选功能使用说明

## 快速开始

在 `config/xhs_config.py` 中设置日期范围：

```python
# 爬取 2025年10月1日 到 2025年10月10日 的笔记
START_DATE = "2025-10-01"
END_DATE = "2025-10-10"
```

## 配置说明

### 日期格式
- **格式**: `YYYY-MM-DD` (例如: `2025-10-01`)
- **不限制**: 设置为空字符串 `""`

### 配置示例

```python
# 示例1: 爬取指定日期范围
START_DATE = "2025-10-01"  
END_DATE = "2025-10-10"

# 示例2: 只设置开始日期（爬取该日期之后的所有笔记）
START_DATE = "2025-10-01"
END_DATE = ""

# 示例3: 只设置结束日期（爬取该日期之前的所有笔记）
START_DATE = ""
END_DATE = "2025-10-10"

# 示例4: 不限制时间（默认）
START_DATE = ""
END_DATE = ""
```

## 时间格式优化

### JSON/CSV 输出
爬取结果会包含两种时间格式：

```json
{
  "note_id": "xxx",
  "title": "笔记标题",
  "time": 1727330723000,                    // 毫秒时间戳（用于程序处理）
  "time_str": "2024-09-26 15:38:43",        // 可读时间（便于阅读）
  "last_update_time": 1727330723000,
  "last_update_time_str": "2024-09-26 15:38:43"
}
```

### 数据库存储
- `time` 字段保存毫秒时间戳 (BigInteger)
- 与原有数据库结构完全兼容

## 工作原理

1. **配置解析**: 系统自动将日期字符串转换为毫秒时间戳
2. **API请求**: 向小红书API发送带时间参数的搜索请求  
3. **结果过滤**: 在获取笔记详情后，再次按时间范围过滤
4. **格式转换**: 保存时自动添加可读的时间格式

## 注意事项

⚠️ **重要提示**:
- 时间筛选仅对**关键词搜索**有效
- 对指定笔记ID爬取无效
- 日期范围**包含开始日期，不包含结束日期的下一天**
  - 例如: `START_DATE="2025-10-01"` `END_DATE="2025-10-10"` 
  - 会爬取 10月1日 00:00:00 至 10月10日 23:59:59 的笔记

## 完整配置示例

```python
# config/xhs_config.py

# 排序方式
SORT_TYPE = "popularity_descending"

# 时间筛选（爬取2025年10月的笔记）
START_DATE = "2025-10-01"
END_DATE = "2025-10-31"

# 指定笔记URL列表
XHS_SPECIFIED_NOTE_URL_LIST = []

# 指定创作者URL列表
XHS_CREATOR_ID_LIST = []
```

## 运行爬虫

配置完成后，正常运行：

```bash
python main.py
```

爬虫会自动应用时间筛选，并在日志中显示：
```
[XiaoHongShuCrawler.search] Time filter - Start: 2025-10-01 (1727712000000)
[XiaoHongShuCrawler.search] Time filter - End: 2025-10-10 (1728489600000)
```
